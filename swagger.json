{
  "openapi": "3.0.3",
  "info": {
    "title": "Ecommerce API",
    "version": "1.0.0",
    "description": "API para un ecommerce con productos, carrito y 贸rdenes. Incluye autenticaci贸n, roles y checkout."
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "email": { "type": "string" }
        }
      },
      "Product": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "price": { "type": "number", "format": "float" },
          "stock": { "type": "integer" },
          "image_url": { "type": "string" },
          "category_id": { "type": "integer" }
        }
      },
      "CartItem": {
        "type": "object",
        "properties": {
          "cart_item_id": { "type": "integer" },
          "product_id": { "type": "integer" },
          "quantity": { "type": "integer" },
          "name": { "type": "string" },
          "price": { "type": "number", "format": "float" },
          "stock": { "type": "integer" }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "user_id": { "type": "integer" },
          "total_amount": { "type": "number", "format": "float" },
          "status": { "type": "string", "enum": ["pending", "paid", "shipped", "cancelled"] },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "OrderItem": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "product_id": { "type": "integer" },
          "quantity": { "type": "integer" },
          "price_at_buy": { "type": "number", "format": "float" },
          "name": { "type": "string" }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Registrar usuario",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["name", "email", "password"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Usuario registrado" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login de usuario",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Login exitoso" }
        }
      }
    },
    "/products": {
      "get": {
        "summary": "Obtener todos los productos",
        "responses": {
          "200": {
            "description": "Lista de productos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Product" }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Crear producto (admin)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": { "schema": { "$ref": "#/components/schemas/Product" } }
          }
        },
        "responses": { "201": { "description": "Producto creado" } }
      }
    },
    "/products/{id}": {
      "get": {
        "summary": "Obtener producto por ID",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Producto encontrado" } }
      },
      "put": {
        "summary": "Actualizar producto (admin)",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/Product" } } }
        },
        "responses": { "200": { "description": "Producto actualizado" } }
      },
      "delete": {
        "summary": "Eliminar producto (admin)",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Producto eliminado" } }
      }
    },
    "/carts": {
      "get": { "summary": "Obtener carrito", "responses": { "200": { "description": "Carrito del usuario" } } },
      "post": {
        "summary": "Agregar producto al carrito",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "product_id": { "type": "integer" },
                  "quantity": { "type": "integer" }
                },
                "required": ["product_id", "quantity"]
              }
            }
          }
        },
        "responses": { "201": { "description": "Producto agregado al carrito" } }
      }
    },
    "/carts/{id}": {
      "put": {
        "summary": "Actualizar cantidad de producto en carrito",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "type": "object", "properties": { "quantity": { "type": "integer" } }, "required": ["quantity"] } } }
        },
        "responses": { "200": { "description": "Cantidad actualizada" } }
      },
      "delete": {
        "summary": "Eliminar producto del carrito",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": { "200": { "description": "Producto eliminado del carrito" } }
      }
    },
    "/orders": {
      "get": { "summary": "Ver 贸rdenes del usuario", "responses": { "200": { "description": "Lista de 贸rdenes" } } },
      "post": { "summary": "Crear orden (checkout)", "responses": { "201": { "description": "Orden creada" } } }
    },
    "/orders/{id}": {
      "get": { "summary": "Ver orden por ID", "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "Orden encontrada" } } },
      "patch": {
        "summary": "Actualizar estado de orden (admin)",
        "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }],
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "type": "object", "properties": { "status": { "type": "string", "enum": ["pending","paid","shipped","cancelled"] } }, "required": ["status"] } } }
        },
        "responses": { "200": { "description": "Estado actualizado" } }
      }
    }
  }
}
